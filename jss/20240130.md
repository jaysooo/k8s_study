## 02ì¥ ë„ì»¤ì—”ì§„ ì •ë¦¬


### Point
- ë„ì»¤ ë„¤íŠ¸ì›Œí¬ ë“œë¼ì´ë²„ ì¤‘ ì˜¤ë²„ë ˆì´ MacVLANì˜ êµ¬ì¡°ì™€ ë°©ì‹ ì´í•´ ë¶€ì¡±. ì´ 2ê°€ì§€ëŠ” ì¤‘ìš”í•œê°€? 
- CMD, ENTRYPOINT ì˜ ì°¨ì´
- ë„ì»¤ ë°ëª¬ì˜ êµ¬ì¡° ìš”ì•½ í•„ìš”.


---


- ë„ì»¤ ì—”ì§„ì˜ ê¸°ë³¸ ë‹¨ìœ„
    - ì´ë¯¸ì§€ / ì»¨í…Œì´ë„ˆ
- ë„ì»¤ ì´ë¯¸ì§€
    - ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•  ë•Œ í•„ìš”í•œ ìš”ì†Œ
    - ì—¬ëŸ¬ ê°œì˜ ê³„ì¸µìœ¼ë¡œ ëœ ë°”ì´ë„ˆë¦¬ íŒŒì¼ë¡œ ì¡´ì¬
    - [ì €ì¥ì†Œ ì´ë¦„] / [ì´ë¯¸ì§€ ì´ë¦„] : [íƒœê·¸]
- ë„ì»¤ ì»¨í…Œì´ë„ˆ
    - ì´ë¯¸ë¥¼ ì½ê¸° ì „ìš©ìœ¼ë¡œ ì‚¬ìš©í•˜ë©´ì„œ ë…ë¦½ëœ íŒŒì¼ ì‹œìŠ¤í…œì„ ì œê³µë°›ëŠ”ë‹¤
    - í•˜ë‚˜ì˜ ì´ë¯¸ì§€ë¡œ ì—¬ëŸ¬ ë…ë¦½ëœ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.
- ë„ì»¤ ì»¨í…Œì´ë„ˆ ë‹¤ë£¨ê¸°
    - ì»¨í…Œì´ë„ˆ ìƒì„±ê³¼ ì‹¤í–‰
    
    ```bash
    $docker run -i -t ubuntu:14.04
    -> i : interactive
    -> t : tty (
    ```
    
    - tty ì˜µì…˜
        - â€”tty
        - ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ í„°ë¯¸ë„ì œì–´ ì˜µì…˜
        - í„°ë¯¸ë„ê³¼ ìœ ì‚¬í•œ ë°©ì‹ìœ¼ë¡œ í˜•ì‹ì„ ì§€ì •í•˜ì—¬ ì¶œë ¥ì„ ë” ì½ê¸° ì‰½ê²Œ ë§Œë“¤ì–´ì¤Œ.
    - interactive ì˜µì…˜
        - -i
        - stdin ì„ ì—´ì–´ë‘ëŠ” ì˜µì…˜
    - ì»¨í…Œì´ë„ˆ í˜¸ìŠ¤íŠ¸ ì´ë¦„ì€ 16ì§„ìˆ˜ í•´ì‹œê°’.
    - ì»¨í…Œì´ë„ˆ ì‹œì‘
        - docker start
    - ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì§„ì…
        - docker attach
    - ì»¨í…Œì´ë„ˆ ìƒì„± ëª…ë ¹ì–´ ì°¨ì´
        - RUN
            - docker pull â†’ docker create â†’ docker start â†’ docker attach (-i -t)
        - CREATE
            - docker pull â†’ docker create
    - docker start [ì»¨í…Œì´ë„ˆ ID ë˜ëŠ” ID 2~3ê¸€ì]
    - ì»¨í…Œì´ë„ˆ ëª©ë¡
        - docker ps
            - ì •ì§€ë˜ì§€ ì•Šì€ ì»¨í…Œì´ë„ˆë¥¼ ì¶œë ¥í•œë‹¤
            - ì •ì§€ëœ ì»¨í…Œì´ë„ˆë¥¼ ëª¨ë‘ ì¶œë ¥í•˜ë ¤ë©´ -a ì˜µì…˜ì„ ì¶”ê°€í•œë‹¤.
    - ì»¨í…Œì´ë„ˆ ì‚­ì œ
        - docker rm [ì»¨í…Œì´ë„ˆ ì´ë¦„]
        - ì‚­ì œ ì‹œ ì‹¤í–‰ì¤‘ì¸ ì»¨í…Œì´ë„ˆëŠ” ê°•ì œë¡œ ì‚­ì œí•˜ê±°ë‚˜ (-f) ì •ì§€ í•´ì•¼ í•œë‹¤.
        - ë„ì»¤ ì»¨í…Œì´ë„ˆ ì¼ê´„ ì‚­ì œ
            - docker container prune
        - ë„ì»¤ ì»¨í…Œì´ë„ˆ ì•„ì´ë””ë§Œ ì¶œë ¥í•˜ê¸°
            - docker ps -a -q
            - docker rm $(docker ps -a -q)
- ì»¨í…Œì´ë„ˆ ì™¸ë¶€ ë…¸ì¶œ
    - ì»¨í…Œì´ë„ˆëŠ” ê°€ìƒ IP ì£¼ì†Œë¥¼ í• ë‹¹ ë°›ìŒ
    - 172.17.0.x ì˜ IP ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ í• ë‹¹í•œë‹¤
        
        ```bash
        root@4fc03b6a4d97:/# cat /etc/hosts
        127.0.0.1	localhost
        ::1	localhost ip6-localhost ip6-loopback
        fe00::0	ip6-localnet
        ff00::0	ip6-mcastprefix
        ff02::1	ip6-allnodes
        ff02::2	ip6-allrouters
        172.17.0.2	4fc03b6a4d97
        ```
        
    - ê¸°ë³¸ì ìœ¼ë¡œ ë„ì»¤ì˜ NAT IP 172.17.0.2 ë¥¼ í• ë‹¹ë°›ì€ eth0 ì¸í„°í˜ì´ìŠ¤ì™€ ë¡œì»¬ í˜¸ìŠ¤íŠ¸ì¸ l0 ì¸í„°í˜ì´ìŠ¤ê°€ ìˆë‹¤.
    - ì™¸ë¶€ì— ì»¨í…Œì´ë„ˆë¥¼ ë…¸ì¶œí•˜ë ¤ë©´ í˜¸ìŠ¤íŠ¸ IP, í¬íŠ¸ì— ë°”ì¸ë”©í•´ì•¼ í•œë‹¤
    - 
    
    ```bash
    $ docker run --name mynginx -p 8888:80 -d nginx
    CONTAINER ID   IMAGE     COMMAND                   CREATED         STATUS        PORTS                  NAMES
    182ea90786c8   nginx     "/docker-entrypoint.â€¦"   2 seconds ago   Up 1 second   0.0.0.0:8888->80/tcp   mynginx
    
    $ curl -XGET localhost:8888                                                                                      î‚² âœ” î‚² 00:48:03 î‚² 100% ğŸ”‹
    <!DOCTYPE html>
    <html>
    <head>
    <title>Welcome to nginx!</title>
    <style>
    html { color-scheme: light dark; }
    body { width: 35em; margin: 0 auto;
    font-family: Tahoma, Verdana, Arial, sans-serif; }
    </style>
    </head>
    <body>
    <h1>Welcome to nginx!</h1>
    <p>If you see this page, the nginx web server is successfully installed and
    working. Further configurati
    ```
    
- ì»¨í…Œì´ë„ˆê°„ ë„¤íŠ¸ì›Œí¬ ì—°ê²°
    
    ```bash
    
    $ docker run -d \
    --name wordpressdb \
    -e MYSQL_ROOT_PASSWORD=pass \
    -e MYSQL_DATABASE=wordpress \
    mysql:5.7
    
    $ docker run -d \
    -e WORDPRESS_DB_HOST=mysql \
    -e WORDPRESS_DB_USER=root \
    -e WORDPRESS_DB_PASSWORD=pass \
    --name wordpress \
    --link wordpressdb:mysql
    -p 80 \
    wordpress
    
    ë§í¬ëŠ” ì‹¤í–‰ì¤‘ì¸ ì»¨í…Œì´ë„ˆë§Œ ì—°ê²°í•  ìˆ˜ ìˆë‹¤. ì¦‰ ì‹¤í–‰ ìˆœì„œì˜ ì˜ì¡´ì„±ë„ ì •ì˜í•´ì¤˜ì•¼ í•œë‹¤.
    ```
    
    - ë„¤íŠ¸ì›Œí¬ ë¸Œë¦¿ì§€ ë°©ì‹
        
        ```bash
        # Create two containers on the default bridge network
        docker run -d --name container1 nginx
        docker run -d --name container2 nginx
        
        # Connect container1 to container2's network
        docker network connect bridge container2
        ```
        
    - custom ë„¤íŠ¸ì›Œí¬ ì´ìš© ë°©ì‹
        
        ```bash
        # Create two containers on the default bridge network
        docker run -d --name container1 nginx
        docker run -d --name container2 nginx
        
        # Connect container1 to container2's network
        docker network connect bridge container2
        ```
        
- ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸
    - docker port [ì»¨í…Œì´ë„ˆì´ë¦„]
- ë„ì»¤ ë³¼ë¥¨
    - ë„ì»¤ì˜ ë³¼ë¥¨ì´ ì—†ë‹¤ë©´?
        - ë„ì»¤ ì´ë¯¸ì§€ê°€ ì½ê¸° ì „ìš©ì´ë¼ë©´ ë„ì»¤ ì»¨í…Œì´ë„ˆëŠ” ì“°ê¸°ê°€ ê°€ëŠ¥í•˜ë‹¤
        - ì»¨í…Œì´ë„ˆ ë ˆì´ì–´ì— ì›ë˜ ì´ë¯¸ì§€ì—ì„œ ë³€ê²½ëœ íŒŒì¼ ì‹œìŠ¤í…œ ë“±ì„ ì €ì¥í•œë‹¤
        - ì¦‰ ì»¨í…Œì´ë„ˆë¥¼ ì‚­ì œí•˜ë©´ ì»¨í…Œì´ë„ˆ ë ˆì´ì–´ì— ì €ì¥ëœ ì •ë³´ë„ ì‚­ì œëœë‹¤.
    - í˜¸ìŠ¤íŠ¸ ë³¼ë¥¨ ê³µìœ 
        - -v ë³¼ë¥¨ ë§ˆìš´íŠ¸ ì˜µì…˜
        - -v [í˜¸ìŠ¤íŠ¸íŒŒì¼ì‹œìŠ¤í…œê²½ë¡œ]:[ì»¨í…Œì´ë„ˆíŒŒì¼ì‹œìŠ¤í…œê²½ë¡œ]
    - ë³¼ë¥¨ ë””ë ‰í† ë¦¬ ê³µìœ 
        - â€”volumes-from
        - ë³¼ë¥¨ì„ ì‚¬ìš©í•˜ëŠ” ì»¨í…Œì´ë„ˆë¥¼ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì™€ ê³µìœ 
    - ë„ì»¤ ë³¼ë¥¨
        - $ docker volume create â€”name [ë³¼ë¥¨ ì´ë¦„]
        - $ docker run -v [ë³¼ë¥¨ì´ë¦„]:/root
        - ì •ë³´ ì¶œë ¥
            - docker inspect â€”type volume [ë³¼ë¥¨ì´ë¦„]
        - 

### ë„ì»¤ ë„¤íŠ¸ì›Œí¬

- ë„ì»¤ëŠ” ê°€ìƒì˜ ë‚´ë¶€ IPë¥¼ ìˆœì°¨ì ìœ¼ë¡œ í• ë‹¹í•œë‹¤. docker0 ë¸Œë¦¬ì§€ê°€ 172.17.0.X IP ëŒ€ì—­ëŒ€ë¥¼ í• ë‹¹
    
    ```bash
    ~ î‚° docker network inspect bridge                                                                                  î‚² âœ” î‚² 01:06:04 î‚² 100% ğŸ”‹
    [
        {
            "Name": "bridge",
            "Id": "4479ac252d099a044677320eece765ac2d45afc8d2f969266fbb5280f4c074a1",
            "Created": "2024-01-29T15:45:07.391069583Z",
            "Scope": "local",
            "Driver": "bridge",
            "EnableIPv6": false,
            "IPAM": {
                "Driver": "default",
                "Options": null,
                "Config": [
                    {
                        "Subnet": "172.17.0.0/16",
                        "Gateway": "172.17.0.1"
                    }
                ]
            },
            "Internal": false,
            "Attachable": false,
            "Ingress": false,
            "ConfigFrom": {
                "Network": ""
            },
            "ConfigOnly": false,
            "Containers": {
                "c7d645dc8488a4dba162d8f0dc82c11b792fb1164a8c3387ec3874580c88337d": {
                    "Name": "my-gninx",
                    "EndpointID": "d86b8d5966b4b77608efd95143edf0b939dc7cda8ecbbc7da2be8de210c606d3",
                    "MacAddress": "02:42:ac:11:00:02",
                    "IPv4Address": "172.17.0.2/16",
                    "IPv6Address": ""
                }
            },
            "Option
    ```
    
- docker0 ë¸Œë¦¬ì§€
    - ì»¨í…Œì´ë„ˆê°€ ì™¸ë¶€ì™€ í†µì‹ í•  ìˆ˜ ìˆëŠ” í™˜ê²½ ì œê³µ
- ë„ì»¤ ë„¤íŠ¸ì›Œí¬ ë“œë¼ì´ë²„
    - ë¸Œë¦¬ì§€
        - ë„ì»¤ ë„¤íŠ¸ì›Œí¬ ê¸°ë³¸ ë“œë¼ì´ë²„
```bash
docker network create --driver=bridge --subnet=172.23.0.0/16 --ip-range=172.23.0.0/24 --gateway=172.23.0.1 my_custom_network
docker network inspect my_custom_network                                                                     î‚² 1 â†µ î‚² 01:15:46 î‚² 100% ğŸ”‹
[
    {
        "Name": "my_custom_network",
        "Id": "92b64584a9f33c09cc35d41284e62514d09e83aed6e1ef4689023f6ac176387a",
        "Created": "2024-01-29T16:14:29.687890968Z",
        "Scope": "local",
        "Driver": "bridge",
        "EnableIPv6": false,
        "IPAM": {
            "Driver": "default",
            "Options": {},
            "Config": [
                {
                    "Subnet": "172.23.0.0/16",
                    "IPRange": "172.23.0.0/24",
                    "Gateway": "172.23.0.1"
                }
            ]
        },
        "Internal": false,
        "Attachable": false,
        "Ingress": false,
        "ConfigFrom": {
            "Network": ""
        },
        "ConfigOnly": false,
        "Containers": {},
        "Options": {},
        "Labels": {}
    }
]
```
        
    - í˜¸ìŠ¤íŠ¸
        - í˜¸ìŠ¤íŠ¸ OS ì˜ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì„ ê·¸ëŒ€ë¡œ ì“°ëŠ” ê²ƒ.
    - ë…¼(none)
        - ì•„ë¬´ëŸ° ë„¤íŠ¸ì›Œí¬ë¥¼ ì“°ì§€ ì•ŠëŠ” ê²ƒ = ì»¨í…Œì´ë„ˆ ì™¸ë¶€ì™€ ì—°ê²°ì´ ë‹¨ì ˆ
    - ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬
        - ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì˜ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™˜ê²½ì„ ê³µìœ 
        - 
    - ì˜¤ë²„ë ˆì´
        - ë¸Œë¦¿ì§€ê°€ ë‹¨ì¼ í˜¸ìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë„¤íŠ¸ì›Œí¬ ë“œë¼ì´ë²„ë¼ë©´, ì˜¤ë²„ë ˆì´ëŠ” ì—¬ëŸ¬ Docker í˜¸ìŠ¤íŠ¸ì— ê±¸ì³ ë¶„ì‚°ëœ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•¨
    - MacVLAN ë„¤íŠ¸ì›Œí¬
        - í˜¸ìŠ¤íŠ¸ì˜ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ì¹´ë“œë¥¼ ê°€ìƒí™”í•´ ë¬¼ë¦¬ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì„ ì»¨í…Œì´ë„ˆì—ê²Œ ë™ì¼í•˜ê²Œ ì œê³µ
    

### ì»¨í…Œì´ë„ˆ ë¡œê¹…

- ìì£¼ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´ë§Œ ì •ë¦¬
    - docker logs [ì»¨í…Œì´ë„ˆ ì´ë¦„]
    - docker ps â€”format â€œtable {{.ID}}\t {{.STATUS}} \t {{.PORTS}}\t{{.Names}}â€
    - docker logs [ì»¨í…Œì´ë„ˆì´ë¦„] â€”tails 10
    - docker logs [ì»¨í…Œì´ë„ˆì´ë¦„] â€”since 1h
- fluentd ë¡œê¹…
    - fluntd ì„œë²„, mongoDB ì„œë²„ ë¥¼ ë³„ë„ë¡œ ë„ì›Œ ë¡œê·¸ ìˆ˜ì§‘í•˜ëŠ” ë°©ë²• ê³µìœ 

### ì»¨í…Œì´ë„ˆ ë¦¬ì†ŒìŠ¤ ì œí•œ

- cpu, memory, disk ë“±ì˜ ì‚¬ìš©ì œí•œì„ í•  ìˆ˜ ìˆìŒ. í•„ìš”í•  ë•Œ ì°¾ì•„ì„œ ì“°ì

### ë„ì»¤ ì´ë¯¸ì§€ ìƒì„±

- ì´ë¯¸ì§€ êµ¬ì¡°ì˜ ì´í•´
    - docker inpsect [ì´ë¯¸ì§€] ë¡œ 16 ì§„ìˆ˜ì˜ í•´ì‹œê°’ìœ¼ë¡œ êµ¬ë¶„ ë˜ëŠ” Layer ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
    - docker history [ì´ë¯¸ì§€ ì´ë¦„] -
        - ì–´ë–¤ ë ˆì´ì–´ë¡œ ìƒì„±ëëŠ”ì§€ ì´ë ¥ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤
    - ë ˆì´ì–´ëŠ” íŒŒì¼ì˜ ìŠ¤ëƒ…ìƒ·ìœ¼ë¡œ ì´í•´í•˜ë©´ ëœë‹¤.
- ì´ë¯¸ì§€ ì¶”ì¶œê³¼ ë¡œë“œ
    - docker save -o nginx_image.tar nginx:latest
    - docker load -i nginx_image.tar
- ì´ë¯¸ì§€ë¥¼ ë‹¨ì¼íŒŒì¼ë¡œ ì €ì¥í•˜ëŠ” ê²ƒì€ ì—¬ëŸ¬ ë²„ì „ì˜ ì´ë¯¸ì§€ë¥¼ ì¶”ì¶œí•˜ë©´ ì´ë¯¸ì§€ ìš©ëŸ‰ ë¬¸ì œë¡œ íš¨ìœ¨ì ì´ì§€ ì•Šë‹¤. ê·¸ë˜ì„œ ë°°í¬ í• ë•Œ ë„ì»¤í—ˆë¸Œ, ì‚¬ì„¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ë¼ëŠ” ì´ë¯¸ì§€ ì €ì¥ì†Œë¥¼ ì´ìš©í•´ ë°°í¬í•œë‹¤.

### Docker file

- ì´ë¯¸ì§€ ë¹Œë“œ ê³¼ì •
    - ë¹Œë“œ ì»¨í…ìŠ¤íŠ¸ ì½ê¸°
        - ì´ë¯¸ì§€ ìƒì„±ì— í•„ìš”í•œ ê°ì¢… íŒŒì¼, ì†ŒìŠ¤ ì½”ë“œ, ë©”íƒ€ ë°ì´í„° ë“±ì„ ë‹´ê³  ìˆëŠ” ë””ë ‰í† ë¦¬ë¥¼ ì˜ë¯¸
        - Dockerfile ì´ ìœ„ì¹˜í•œ ë””ë ‰í† ë¦¬ê°€ ë¹Œë“œ ì»¨í…ìŠ¤íŠ¸
    - .dockerignore ë¡œ ë¹Œë“œì— íŠ¹ì • íŒŒì¼ë“¤ì„ ì œì™¸ í•  ìˆ˜ ìˆë‹¤
    - ADD/RUN/COPY ë“± ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë  ë–„ë§ˆë‹¤ ìƒˆë¡œìš´ ì»¨í…Œì´ë„ˆê°€ í•˜ë‚˜ì”© ìƒì„±ë˜ë©° ì´ë¯¸ì§€ë¡œ ì»¤ë°‹í•¨
    - Dokerfile ëª…ë ¹ì–´ ì¤„ ìˆ˜ ë§Œí¼ ë ˆì´ì–´ê°€ ì¡´ì¬í•˜ë©°,ì¤‘ê°„ì— ì»¨í…Œì´ë„ˆë„ ê°™ì€ ìˆ˜ë§Œí¼ ìƒì„±ë˜ê³  ì‚­ì œëœë‹¤.
    - ìºì‹œë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë ¤ë©´
        - â€”no-cache ì˜µì…˜ì„ ì¶”ê°€í•˜ê³  ê¸°ë³¸ì ìœ¼ë¡œ ìºì‹œë¥¼ ì“´ë‹¤.
- ë©€í‹° ìŠ¤í…Œì´ì§€ë¥¼ ì´ìš©í•œ Docker build

### ë„ì»¤ ë°ëª¬

- ë„ì»¤ì˜ êµ¬ì¡°
    - í´ë¼ì´ì–¸íŠ¸ë¡œì„œì˜ ë„ì»¤
    - ì„œë²„ë¡œì„œì˜ ë„ì»¤